FROM mysql:debian

ENV MYSQL_ROOT_PASSWORD=root

COPY ./init.sql /docker-entrypoint-initdb.d/


ADD ./ /api/
WORKDIR /api/public

RUN apt update -y \
&& apt upgrade -y \
&& apt install wget curl -y\
&&apt -y install lsb-release apt-transport-https ca-certificates \
&& wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg \
&& echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" | tee /etc/apt/sources.list.d/php.list \
&& apt update -y\
&& apt upgrade -y\
&& apt install php php-cli php-common php-mbstring php-xml php-zip php-mysql php-curl -y \
&& curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \
&& sed -i '6i composer global require laravel/installer&' /usr/local/bin/docker-entrypoint.sh \
&& sed -i '5i composer install --working-dir=/api&' /usr/local/bin/docker-entrypoint.sh \
&& sed -i '4i php -S 0.0.0.0:8000&' /usr/local/bin/docker-entrypoint.sh 


EXPOSE 8000